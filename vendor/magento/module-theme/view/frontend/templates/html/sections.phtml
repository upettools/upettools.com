<?php
/**
 * Copyright Â© 2013-2017 Magento, Inc. All rights reserved.
 * See COPYING.txt for license details.
 */

// @codingStandardsIgnoreFile

?>
<?php

/**
*  General template for displaying group of blocks devided into sections
*/

$group = $block->getGroupName();
$groupCss = $block->getGroupCss();
$groupBehavior = $block->getGroupBehaviour() ? $block->getGroupBehaviour() : '{"tabs":{"openedState":"active"}}';
?>
<style>
    @media only screen and (min-width: 769px), print{
        .header-menu .nav-sections>.customize-header,
        .header-menu .nav-sections>.choose-sections,
        .account-list.header.links.hasLogin{display:none!important;}
        .header-menu .nav-sections>.section-items{display: block!important;}
    }
    @media only screen and (max-width: 768px), print{
        .header-menu>.nav-sections{background-color: #f7f7fa;}
        .nav-sections-items{display:flex;display: -webkit-flex; /* Safari */flex-wrap:wrap;}
        .nav-sections-items>div{display:flex;display: -webkit-flex; /* Safari */-webkit-flex-grow: 1;flex-grow: 1;-webkit-flex-basis: 100%;flex-basis: 100%;background:#ffffff;}
        .nav-sections-item-title[aria-controls="store.links"],
        .nav-sections-item-title[aria-controls="store.links"]+.nav-sections-item-content{-ms-flex-order: -1;-webkit-order: -1;order: -1;}
        .nav-sections-item-title[aria-controls="store.links"],.nav-sections-item-title[aria-controls="store.settings"]{display:none;}
        .nav-sections-item-title{float:none;width: auto;height: auto;background: none;border: none;padding:0;text-align:left;}
        .nav-sections-item-title.active{background:#ffffff;}
        .nav-sections-item-title[aria-controls="store.links"]+.nav-sections-item-content,
        .nav-sections-item-title[aria-controls="store.menu"]+.nav-sections-item-content{margin-bottom: 8px;padding: 0 15px 0;border-bottom: 1px solid #e2e5f1;
            box-shadow: 0 1px 1px rgba(0,0,0,0.04);}
        .nav-sections-item-title[aria-controls="store.menu"],
        .nav-sections-item-title[aria-controls="store.settings"]{box-shadow: 0 -1px 1px rgba(0,0,0,0.04);}
        .nav-sections-item-title[aria-controls="store.settings"]+.nav-sections-item-content{/*margin-bottom: 40px;*/}
        .nav-sections-item-content ul.contact{list-style: none;margin: 0; padding: 0;border-bottom: 1px solid #e2e5f1;}
        .nav-sections-item-content ul.contact li{display: inline-block;float: left;width: 49%;box-sizing: border-box;margin: 0;padding: 14px 15px;}
        .nav-sections-item-content ul.contact li:nth-child(1){border-right: 1px solid #e2e5f1;}
        .nav-sections-item-content ul.contact li a{color: #7e859b;}
        .nav-sections-item-content ul.contact li span{margin-left:12px;}
        .nav-sections-item-content ul.contact li .fa-phone-square{font-size: 15px;}
        .nav-sections-item-content[id="store.settings"]+.nav-sections-item-content{margin-bottom: 40px;}
        .nav-sections-item-title[aria-controls="store.menu"]{padding:16px 15px 0;}
        .nav-sections-item-title[aria-controls="store.menu"] a{color: #7e859b;text-transform: uppercase;font-weight: 700;-webkit-letter-spacing: 0.01em;
            -moz-letter-spacing: 0.01em;-ms-letter-spacing: 0.01em;letter-spacing: 0.01em;font-size: 0.83333rem;}
        .nav-sections-item-content{display:block!important;float:none;margin:0;padding:0;}
        .navigation .level0{border-bottom:none;}
        .nav-sections-item-title .nav-sections-item-switch,
        .nav-sections-item-title .nav-sections-item-switch:hover{color:#333;}
        /* not sign in */
        /* sign in */
        .hasLogin+.header.links{display:none;}
        /*customize-header*/
        .customize-header{padding: 12px 15px 8px 15px;background:#fff;border-bottom: 1px solid #e2e5f1;}
        .customize-header .img{margin: 0 0 6px -8px}
        .customize-header .img img{display: inline-block;width: 120px;}
        .customize-header .greeting{font-size: 14px;font-weight: 600;font-family: Helvetica;}
        /*customize-section*/
        .choose-sections{display: none;background-color: #fff;margin-top: 8px;padding: 16px 15px 0;border-bottom: 1px solid #e2e5f1;
            box-shadow: 0 0 1px rgba(0,0,0,0.04);}
        .customize-section{}
        .customize-section .title{cursor: pointer;padding: 0;font-size:12px;}
        .customize-section .title .fa-angle-left{font-size: 16px;margin-right: 10px;}
        .customize-section>.childMenu{margin: 15px 0 0 0;padding:0;}
        .customize-section>.childMenu>li{position:relative;border-top: 1px solid #ddd;word-wrap: break-word;
            list-style: none none;list-style-type: none;list-style-position: initial;list-style-image: none;margin-bottom: 0;}
        .customize-section>.childMenu>li>a,
        .customize-section>.childMenu>li>strong{display: block;position: relative;padding:14px 0;line-height: normal;font-size:14px;font-family: 'Helvetica Neue';font-weight:normal;}
        .menu-section.customize-section>.childMenu>li>a,
        .menu-section.customize-section>.childMenu>li>strong{padding-left:30px;}
        /*account icon*/
        .menu-section.customize-section>.childMenu>li>a:before,
        .menu-section.customize-section>.childMenu>li:nth-child(2) strong:before,
        .menu-section.customize-section>.childMenu>li:nth-child(5) strong:before{display: inline-block;content: "\f104";position: absolute;left: 0;font: normal normal normal 16px/1 FontAwesome;
            font-size: inherit;text-rendering: auto;-webkit-font-smoothing: antialiased;-moz-osx-font-smoothing: grayscale;color:#0584bb;}
        .menu-section.customize-section>.childMenu>li:nth-child(1)>a:before{content: "\f007";}
        .menu-section.customize-section>.childMenu>li:nth-child(2)>a:before,
        .menu-section.customize-section>.childMenu>li:nth-child(2) strong:before{content: "\f07a";}
        .menu-section.customize-section>.childMenu>li:nth-child(3)>a:before{content: "\f004";}
        .menu-section.customize-section>.childMenu>li:nth-child(4)>a:before{content: "\f066";}
        .menu-section.customize-section>.childMenu>li:nth-child(5)>a:before,
        .menu-section.customize-section>.childMenu>li:nth-child(5) strong:before{content: "\f09d";}
        .menu-section.customize-section>.childMenu>li:nth-child(6)>a:before{content: "\f08b";}
        .customize-section>.childMenu>li:nth-child(1){border-top:none;}
        .customize-section>.childMenu>li.parent>a:after{-webkit-font-smoothing: antialiased;
            font-size: 14px;line-height: inherit;color: inherit;content: '\e608';;
            font-family: 'luma-icons';vertical-align: middle;display: inline-block;
            font-weight: normal;overflow: hidden;speak: none;text-align: center;position: absolute;right: 14px;top: 10px;}
        .menu-section.customize-section>.childMenu>li>a:after{display:none;}
        .customize-section>.childMenu>li>a+.open-children-toggle{height: 100%;display: block;position: absolute;
            width: 42px;height: 42px;right: 0;top: 0;z-index: 1;cursor: pointer;}
        .customize-section>.childMenu>li>.subchildmenu.submenu{display:none;}
    }
</style>
<?php if ($detailedInfoGroup = $block->getGroupChildNames($group, 'getChildHtml')):?>
    <div class="sections <?php /* @escapeNotVerified */ echo $groupCss ?>">
        <?php $layout = $block->getLayout(); ?>
        <?php 
            $om = \Magento\Framework\App\ObjectManager::getInstance(); 
            $logo=$om->get('Magento\Theme\Block\Html\Header\Logo');
            $objectManager = \Magento\Framework\App\ObjectManager::getInstance();
            $customerSession = $objectManager->get('Magento\Framework\App\Http\Context');
            //$customerSessionLogin = $objectManager->get('Magento\Customer\Model\Session');
            $isLoggedIn = $customerSession->getValue(\Magento\Customer\Model\Context::CONTEXT_AUTH); 
            $storeManager = $objectManager->get('\Magento\Store\Model\StoreManagerInterface');
			$customerSessionLogin = $objectManager->create('Magento\Customer\Model\SessionFactory')->create();
        ?>
        <div class="customize-header">
            <div class="img">
                <img src="<?php /* @escapeNotVerified */ echo $logo->getLogoSrc() ?>" alt="<?php /* @escapeNotVerified */ echo $logo->getLogoAlt() ?>"/>  
            </div>
            <p class="greeting">Hi, 
                <?php if($isLoggedIn):?>
				<strong class="" data-bind="scope: 'customer'">
					<span data-bind="text: customer().fullname ? customer().firstname  : ''"></span>
				</strong>
				<?php
                  //$customer = $objectManager->create('Magento\Customer\Model\Customer')->load($customerSessionLogin->getCustomer()->getId());
				  //echo $customer->getFirstname().' '.$customer->getLastname();
				?>
				    <?php //echo $customerSessionLogin->getCustomer()->getId(); ?>
                    <?php // echo $customerSessionLogin->getCustomer()->getFirstname().' '.$customerSessionLogin->getCustomer()->getLastname(); ?>
                <?php else:?>
                    We Are Upettools
                <?php endif; ?>
            </p>
        </div>
        <div class="section-items <?php /* @escapeNotVerified */ echo $groupCss ?>-items  customize-sections" data-mage-init='<?php /* @escapeNotVerified */ echo $groupBehavior ?>'>
            <?php foreach ($detailedInfoGroup as $key => $name):?>
                <?php
                    $html = $layout->renderElement($name);
                    if (!trim($html) && ($block->getUseForce() != true)) {
                        continue;
                    }
                    $alias = $layout->getElementAlias($name);
                    $label = $block->getChildData($alias, 'title');
                ?>
                <div class="section-item-title <?php /* @escapeNotVerified */ echo $groupCss ?>-item-title" data-role="collapsible">
                    <a class="<?php /* @escapeNotVerified */ echo $groupCss ?>-item-switch" data-toggle="switch" href="#<?php /* @escapeNotVerified */ echo $alias; ?>"><?php /* @escapeNotVerified */ echo $label; ?></a>
                </div>
                <div class="section-item-content <?php /* @escapeNotVerified */ echo $groupCss ?>-item-content" id="<?php /* @escapeNotVerified */ echo $alias; ?>" data-role="content">
                    <?php /* @escapeNotVerified */ echo $html; ?>
                    <?php if ($key == 1 && $isLoggedIn): ?>
                        <div class="account-list header links hasLogin">
                            <a class="home-link" href="<?php echo $storeManager->getStore()->getBaseUrl(); ?>"><i class="fa fa-home" aria-hidden="true"></i>Home</a>
                            <a class="account-link showAccountList" href="javascript:void(0);"><i class="fa fa-user" aria-hidden="true"></i>Account</a>
                            <a class="cart-link" href="<?php echo $storeManager->getStore()->getBaseUrl().'checkout/cart/' ?>"><i class="fa fa-shopping-cart" aria-hidden="true"></i>Cart</a>
                            <a class="wishlist-link" href="<?php echo $storeManager->getStore()->getBaseUrl().'wishlist/'; ?>"><i class="fa fa-heart" aria-hidden="true"></i>Wishlist</a> 
                        </div>
                    <?php endif;?>
                </div>
            <?php endforeach;?>
            <!-- New add at mobile footer -->
            <div class="section-item-content nav-sections-item-content" data-role="content" role="tabpanel" aria-hidden="true">
                <ul class="contact clearfix">
                    <li><a href="mailto:sales@upettools.com"><i class="fa fa-envelope" aria-hidden="true"></i><span>E-mail to us</span></a></li>
                    <li><a href="tel:+86-13510148968"><i class="fa fa-phone-square" aria-hidden="true"></i><span>Contact</span></a></li>
                </ul>
            </div>
        </div>
        <div class="choose-sections"></div>
    </div>
    <script type="text/javascript">
        require([
            'jquery'
        ],function($){
            $(document).ready(function(){

                if(_isMobile()){
                    updateDealLeft();//move hot deal
                    var $newSections = $('.choose-sections');
                    var $customize = $('.customize-sections');
                    _renderSection('.header-menu>.nav-sections');
                    $('.choose-sections').on('click','.customize-section .title',function(){
                        var level = $(this).closest('.customize-section').attr('data-customize');
                        if(level == 1){
                            _hideChildMenu();
                        }else if(level > 1 && level < 9){
                            _showChildMenu(level - 1);
                        }else if(level == 99){
                            $newSections.find('.menu-section').remove();
                            _hideChildMenu();
                        }
                    });
                    $('.showAccountList').click(function(){
                        var $accountList = $(this).closest('.section-item-content').find('ul.dropdown').eq(0);
                        var lev = 99;
                        var con = $accountList.html();
                        $newSections.append('<div class="customize-section menu-section" data-customize="' + lev + '">'
                            + '<div class="title"><i class="fa fa-angle-left" aria-hidden="true"></i>Back to Menu</div>'
                            + '<ul class="childMenu childMenuList">' + con+ '</ul></div>');
                        _showChildMenu(lev);
                    });
                }
                //render section
                function _renderSection(selector){
                    var $links = $(selector);
                    $links.on('click','.open-children-toggle',function(){
                        var $toggle = $(this);
                        var $li = $toggle.closest('.ui-menu-item');
                        var level = _getLevel($li.attr('class'));
                        var content = $li.find('ul.subchildmenu').html();
                        _updateSection(level,content);
                    });
                }
                //is small screen
                function _isMobile(){
                    var _tmpWWidth = $(window).width();
                    return _tmpWWidth > 768 ? false : true;
                }
                //get parent level
                function _getLevel(str){
                    if(str.indexOf('level')){
                        return str.split('level')[1].substring(0,1);
                    }else{
                        return false;
                    }
                }
                //create section
                function _createSection(lev,con){
                    var _sectionLen = $newSections.find('.customize-section').length;
                    var _diff = lev - _sectionLen;
                    if(_diff > 0){
                        $newSections.append('<div class="customize-section" data-customize="' + lev + '">'
                        + '<div class="title"><i class="fa fa-angle-left" aria-hidden="true"></i>Back to Menu</div>'
                        + '<ul class="childMenu childMenuList">' + con+ '</ul></div>');
                    }else{
                        $newSections.find('.customize-section').eq(lev - 1).find('.childMenuList').html(con);
                    }
                }
                //update section
                function _updateSection(lev,con){
                    _createSection(lev,con);
                    _showChildMenu(lev);
                }
                //show childmenu
                function _showChildMenu(lev){
                    $customize.hide();
                    if(lev < 9){
                        $newSections.show()
                            .find('.customize-section').eq(lev - 1).show().siblings().hide();
                    }else{
                        $newSections.show().find('.menu-section').show().siblings().hide();
                    }
                }
                //hide childmeny
                function _hideChildMenu(){
                    $newSections.hide();
                    $customize.show();
                }
                //update hot-deal-content deal-left
                function updateDealLeft(){
                    $('.section-prolist-feature .prolist-feature-middle').html($('.hot-deal-content .deal-left').detach());
                }
            });
        });
    </script>
<?php endif; ?>
