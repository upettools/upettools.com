<?php
/**
 * Copyright Â© 2013-2017 Magento, Inc. All rights reserved.
 * See COPYING.txt for license details.
 */

// @codingStandardsIgnoreFile

?>
<?php

/**
*  General template for displaying group of blocks devided into sections
*/

$group = $block->getGroupName();
$groupCss = $block->getGroupCss();
$groupBehavior = $block->getGroupBehaviour() ? $block->getGroupBehaviour() : '{"tabs":{"openedState":"active"}}';
?>
<style>
    @media only screen and (min-width: 769px), print{
        .header-menu .nav-sections>.customize-header,
        .header-menu .nav-sections>.choose-sections{display:none;}
    }
    @media only screen and (max-width: 768px), print{
        .header-menu>.nav-sections{background-color: #f7f7fa;}
        .nav-sections-items{display:flex;display: -webkit-flex; /* Safari */flex-wrap:wrap;}
        .nav-sections-items>div{display:flex;display: -webkit-flex; /* Safari */-webkit-flex-grow: 1;flex-grow: 1;-webkit-flex-basis: 100%;flex-basis: 100%;background:#ffffff;}
        .nav-sections-item-title[aria-controls="store.links"],
        .nav-sections-item-title[aria-controls="store.links"]+.nav-sections-item-content{-ms-flex-order: -1;-webkit-order: -1;order: -1;}
        .nav-sections-item-title[aria-controls="store.links"],.nav-sections-item-title[aria-controls="store.settings"]{display:none;}
        .nav-sections-item-title{float:none;width: auto;height: auto;background: none;border: none;padding:0;text-align:left;}
        .nav-sections-item-title.active{background:#ffffff;}
        .nav-sections-item-title[aria-controls="store.links"]+.nav-sections-item-content,
        .nav-sections-item-title[aria-controls="store.menu"]+.nav-sections-item-content{margin-bottom: 8px;padding: 0 15px 0;border-bottom: 1px solid #e2e5f1;
            box-shadow: 0 1px 1px rgba(0,0,0,0.04);}
        .nav-sections-item-title[aria-controls="store.menu"],
        .nav-sections-item-title[aria-controls="store.settings"]{box-shadow: 0 -1px 1px rgba(0,0,0,0.04);}
        .nav-sections-item-title[aria-controls="store.menu"]{padding:16px 15px 0;}
        .nav-sections-item-title[aria-controls="store.menu"] a{color: #7e859b;text-transform: uppercase;font-weight: 700;-webkit-letter-spacing: 0.01em;
            -moz-letter-spacing: 0.01em;-ms-letter-spacing: 0.01em;letter-spacing: 0.01em;font-size: 0.83333rem;}
        .nav-sections-item-content{display:block!important;float:none;margin:0;padding:0;}
        .navigation .level0{border-bottom:none;}
        .nav-sections-item-title .nav-sections-item-switch,
        .nav-sections-item-title .nav-sections-item-switch:hover{color:#333;}
        /*customize-header*/
        .customize-header{padding: 12px 15px 8px 15px;background:#fff;border-bottom: 1px solid #e2e5f1;}
        .customize-header .img{margin: 0 0 6px -8px}
        .customize-header .img img{display: inline-block;width: 120px;}
        .customize-header .greeting{font-size: 16px;font-weight: 600;}
        /*customize-section*/
        .choose-sections{display: none;background-color: #fff;margin-top: 8px;padding: 16px 15px 0;border-bottom: 1px solid #e2e5f1;
            box-shadow: 0 0 1px rgba(0,0,0,0.04);}
        .customize-section{}
        .customize-section .title{cursor: pointer;padding: 0;font-size:12px;}
        .customize-section .title .fa-angle-left{font-size: 16px;margin-right: 10px;}
        .customize-section>.childMenu{margin: 15px 0 0 0;padding:0;}
        .customize-section>.childMenu>li{position:relative;border-top: 1px solid #ddd;word-wrap: break-word;
            list-style: none none;list-style-type: none;list-style-position: initial;list-style-image: none;}
        .customize-section>.childMenu>li>a{display: block;position: relative;padding:14px 0;line-height: normal;}
        .customize-section>.childMenu>li:nth-child(1){border-top:none;}
        .customize-section>.childMenu>li>a:after{-webkit-font-smoothing: antialiased;
            font-size: 13px;line-height: inherit;color: inherit;content: '\e609';;
            font-family: 'luma-icons';vertical-align: middle;display: inline-block;
            font-weight: normal;overflow: hidden;speak: none;text-align: center;position: absolute;right: 14px;top: 10px;}
        .customize-section>.childMenu>li>a+.open-children-toggle{height: 100%;display: block;position: absolute;
            width: 42px;height: 42px;right: 0;top: 0;z-index: 1;cursor: pointer;}
        .customize-section>.childMenu>li>.subchildmenu.submenu{display:none;}
    }
</style>
<?php if ($detailedInfoGroup = $block->getGroupChildNames($group, 'getChildHtml')):?>
    <div class="sections <?php /* @escapeNotVerified */ echo $groupCss ?>">
        <?php $layout = $block->getLayout(); ?>
        <?php 
            $om = \Magento\Framework\App\ObjectManager::getInstance(); 
            $logo=$om->get('Magento\Theme\Block\Html\Header\Logo');
        ?>
        <div class="customize-header">
            <div class="img">
                <img src="<?php /* @escapeNotVerified */ echo $logo->getLogoSrc() ?>" alt="<?php /* @escapeNotVerified */ echo $logo->getLogoAlt() ?>"/>  
            </div>
            <p class="greeting">Hi, We Are Upettools</p>
        </div>
        <div class="section-items <?php /* @escapeNotVerified */ echo $groupCss ?>-items  customize-sections" data-mage-init='<?php /* @escapeNotVerified */ echo $groupBehavior ?>'>
            <?php foreach ($detailedInfoGroup as $name):?>
                <?php
                    $html = $layout->renderElement($name);
                    if (!trim($html) && ($block->getUseForce() != true)) {
                        continue;
                    }
                    $alias = $layout->getElementAlias($name);
                    $label = $block->getChildData($alias, 'title');
                ?>
                <div class="section-item-title <?php /* @escapeNotVerified */ echo $groupCss ?>-item-title" data-role="collapsible">
                    <a class="<?php /* @escapeNotVerified */ echo $groupCss ?>-item-switch" data-toggle="switch" href="#<?php /* @escapeNotVerified */ echo $alias; ?>"><?php /* @escapeNotVerified */ echo $label; ?></a>
                </div>
                <div class="section-item-content <?php /* @escapeNotVerified */ echo $groupCss ?>-item-content" id="<?php /* @escapeNotVerified */ echo $alias; ?>" data-role="content"><?php /* @escapeNotVerified */ echo $html; ?></div>
            <?php endforeach;?>
        </div>
        <div class="choose-sections"></div>
    </div>
    <script type="text/javascript">
        require([
            'jquery'
        ],function($){
            $(document).ready(function(){
                
                if(_isMobile()){
                    var $newSections = $('.choose-sections');
                    var $customize = $('.customize-sections');
                    _renderSection('.header-menu>.nav-sections');
                    $('.choose-sections').on('click','.customize-section .title',function(){
                        var level = $(this).closest('.customize-section').attr('data-customize');
                        if(level == 1){
                            _hideChildMenu();
                        }else if(level > 1){
                            _showChildMenu(level - 1);
                        }
                    });
                }
                //render section
                function _renderSection(selector){
                    var $links = $(selector);
                    $links.on('click','.open-children-toggle',function(){
                        var $toggle = $(this);
                        var $li = $toggle.closest('.ui-menu-item');
                        var level = _getLevel($li.attr('class'));
                        var content = $li.find('ul.subchildmenu').html();
                        _updateSection(level,content);
                    });
                }
                //is small screen
                function _isMobile(){
                    var _tmpWWidth = $(window).width();
                    return _tmpWWidth > 768 ? false : true;
                }
                //get parent level
                function _getLevel(str){
                    if(str.indexOf('level')){
                        return str.split('level')[1].substring(0,1);
                    }else{
                        return false;
                    }
                }
                //create section
                function _createSection(lev,con){
                    var _sectionLen = $newSections.find('.customize-section').length;
                    var _diff = lev - _sectionLen;
                    if(_diff > 0){
                        $newSections.append('<div class="customize-section" data-customize="' + lev + '">'
                        + '<div class="title"><i class="fa fa-angle-left" aria-hidden="true"></i>Back to Menu</div>'
                        + '<ul class="childMenu childMenuList">' + con+ '</ul></div>');
                    }else{
                        $newSections.find('.customize-section').eq(lev - 1).find('.childMenuList').html(con);
                    }
                }
                //update section
                function _updateSection(lev,con){
                    _createSection(lev,con);
                    _showChildMenu(lev);
                }
                //show childmenu
                function _showChildMenu(lev){
                    $newSections.show()
                        .find('.customize-section').eq(lev - 1).show().siblings().hide();
                    $customize.hide();
                }
                //hide childmeny
                function _hideChildMenu(){
                    $newSections.hide();
                    $customize.show();
                }
            });
        });
    </script>
<?php endif; ?>
